import{a as j,b as c,c as D,d as z,e as H,f as g,h as O,i as B,j as $,k as J,l as K,o as Q}from"./chunk-IEOCVV27.js";import{Aa as s,Ba as F,Ca as E,Da as I,E as C,Fa as L,Fb as G,Ga as N,H as b,I as y,M as k,N as w,Na as V,Nb as P,O as d,Oa as a,P as x,Pa as R,ca as l,db as T,ia as S,na as p,ob as M,ra as m,ta as _,tb as q,ya as t,yb as A,za as o}from"./chunk-EFRFJ76O.js";var v=class n{constructor(r,i){this.http=r;this.auth=i}creatCheckout(r,i){return this.http.post(`https://ecommerce.routemisr.com/api/v1/orders/checkout-session/${r}?url=http://localhost:4200/user`,{shippingAddress:i},{headers:{token:this.auth.getTokenFromLocalStorage()}})}static \u0275fac=function(i){return new(i||n)(b(A),b(P))};static \u0275prov=C({token:n,factory:n.\u0275fac,providedIn:"root"})};function Y(n,r){n&1&&(t(0,"div",15)(1,"small",16),d(),t(2,"svg",17),s(3,"path",18),o(),a(4," Address is required (min 5 characters) "),o()())}function Z(n,r){n&1&&(t(0,"div",15)(1,"small",16),d(),t(2,"svg",17),s(3,"path",18),o(),a(4," Valid phone number is required "),o()())}function ee(n,r){n&1&&(t(0,"div",15)(1,"small",16),d(),t(2,"svg",17),s(3,"path",18),o(),a(4," City is required "),o()())}function te(n,r){n&1&&(F(0),a(1," Confirm Payment "),E())}function re(n,r){n&1&&(d(),t(0,"svg",19),s(1,"path",20)(2,"path",21),o(),x(),t(3,"span"),a(4,"Processing..."),o())}function oe(n,r){if(n&1&&(t(0,"div",22),d(),t(1,"svg",23),s(2,"path",24),o(),x(),t(3,"span"),a(4),o()()),n&2){let i=N();l(4),R(i.msgResponse)}}var U=class n{msgResponse="";isLoading=!1;cartid="";activatedRoute=y(G);orderService=y(v);checkoutForm=new H({address:new g("",[c.required,c.minLength(3)]),phoneNumber:new g("",[c.required,c.pattern(/^\d+$/)]),city:new g("",[c.required,c.minLength(3)])});getCartId(){this.activatedRoute.params.subscribe({next:r=>{this.cartid=r.id,console.log(this.cartid)},error:r=>{console.error("Error fetching cart ID:",r)}})}ngOnInit(){this.getCartId()}submitInput(){this.checkoutForm.markAllAsTouched(),this.checkoutForm.valid&&(this.isLoading=!0,console.log("Checkout data:",this.checkoutForm.value),this.orderService.creatCheckout(this.cartid,this.checkoutForm.value).subscribe({next:r=>{this.isLoading=!1,this.msgResponse="\u2705 Payment processed successfully!",console.log("Payment response:",r),window.location.href=r.session.url},error:r=>{this.isLoading=!1,this.msgResponse="\u274C Error processing payment!",console.error("Payment error:",r)}}),setTimeout(()=>{this.isLoading=!1,this.msgResponse="\u2705 Payment processed successfully!",this.checkoutForm.reset()},2e3))}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=S({type:n,selectors:[["app-checkout"]],decls:25,vars:16,consts:[["loading",""],[1,"max-w-md","mx-auto","py-14"],[1,"bg-white","text-gray-950","shadow-md","rounded","p-7",3,"ngSubmit","formGroup"],[1,"w-full","text-2xl","py-3"],[1,"relative","z-0","w-full","mb-5","group"],["type","text","formControlName","address","id","address","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","peer","focus:outline-none","focus:ring-0","focus:border-blue-600"],["for","address",1,"peer-focus:font-medium","absolute","text-sm","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-6","text-gray-500","peer-focus:text-blue-600"],["class","mt-1",4,"ngIf"],["type","text","formControlName","phoneNumber","id","phoneNumber","maxlength","11","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","peer","focus:outline-none","focus:ring-0","focus:border-blue-600"],["for","phoneNumber",1,"peer-focus:font-medium","absolute","text-sm","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-6","text-gray-500","peer-focus:text-blue-600"],["type","text","formControlName","city","id","city","maxlength","11","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","peer","focus:outline-none","focus:ring-0","focus:border-blue-600"],["for","city",1,"peer-focus:font-medium","absolute","text-sm","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-6","text-gray-500","peer-focus:text-blue-600"],["type","submit",1,"text-white","bg-blue-700","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","w-full","px-5","py-2.5","text-center","flex","items-center","justify-center","gap-2",3,"disabled"],[4,"ngIf","ngIfElse"],["class","flex items-center p-4 mt-4 text-green-800 rounded-lg bg-green-50","role","alert",4,"ngIf"],[1,"mt-1"],[1,"text-red-500","text-xs","italic","flex","items-center","gap-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-4","h-4","text-red-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"inline","w-5","h-5","text-gray-200","animate-spin","dark:text-gray-600","fill-white"],["d","M100 50.5908C100 78.2051 ...","fill","currentColor"],["d","M93.9676 39.0409 ...","fill","currentFill"],["role","alert",1,"flex","items-center","p-4","mt-4","text-green-800","rounded-lg","bg-green-50"],["aria-hidden","true","fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","inline-flex","mr-3","text-green-700"],["fill-rule","evenodd","d","M10 18a8 8 0 1 0 0-16...","clip-rule","evenodd"]],template:function(i,e){if(i&1){let u=I();t(0,"section")(1,"div",1)(2,"form",2),L("ngSubmit",function(){return k(u),w(e.submitInput())}),t(3,"h2",3),a(4,"Checkout"),o(),t(5,"div",4),s(6,"input",5),t(7,"label",6),a(8," Address "),o(),p(9,Y,5,0,"div",7),o(),t(10,"div",4),s(11,"input",8),t(12,"label",9),a(13," Phone Number "),o(),p(14,Z,5,0,"div",7),o(),t(15,"div",4),s(16,"input",10),t(17,"label",11),a(18," City "),o(),p(19,ee,5,0,"div",7),o(),t(20,"button",12),p(21,te,2,0,"ng-container",13)(22,re,5,0,"ng-template",null,0,T),o(),p(24,oe,5,1,"div",14),o()()()}if(i&2){let u,f,h,W=V(23);l(2),m("formGroup",e.checkoutForm),l(7),m("ngIf",((u=e.checkoutForm.get("address"))==null?null:u.invalid)&&((u=e.checkoutForm.get("address"))==null?null:u.touched)),l(5),m("ngIf",((f=e.checkoutForm.get("phoneNumber"))==null?null:f.invalid)&&((f=e.checkoutForm.get("phoneNumber"))==null?null:f.touched)),l(5),m("ngIf",((h=e.checkoutForm.get("city"))==null?null:h.invalid)&&((h=e.checkoutForm.get("city"))==null?null:h.touched)),l(),_("bg-gray-500",e.checkoutForm.invalid||e.isLoading)("opacity-100",e.checkoutForm.invalid&&!e.isLoading)("cursor-pointer",e.checkoutForm.valid&&!e.isLoading)("cursor-not-allowed",e.checkoutForm.invalid||e.isLoading),m("disabled",e.checkoutForm.invalid||e.isLoading),l(),m("ngIf",!e.isLoading)("ngIfElse",W),l(3),m("ngIf",e.msgResponse)}},dependencies:[q,M,Q,O,j,D,z,J,K,B,$],encapsulation:2})};export{U as CheckoutComponent};
